# BFF 서버

Fastify 기반으로 구축된 고성능 Backend for Frontend (BFF) 서버입니다. 도메인 데이터를 UI에 최적화된 형태로 변환하여 프론트엔드 개발 및 렌더링 성능을 극대화합니다.

## 개요

이 BFF 서버는 프론트엔드 애플리케이션과 도메인 서비스 사이의 중간 계층으로 동작하며, 다음과 같은 핵심 기능을 제공합니다:

### 핵심 기능
- **데이터 변환**: 도메인 데이터를 UI 컴포넌트가 직접 사용할 수 있는 형태로 변환
- **비즈니스 로직 처리**: 프론트엔드 로직 복잡성을 줄이기 위해 BFF 단계에서 비즈니스 규칙 적용
- **API 집계**: 여러 도메인 서비스의 데이터를 조합하여 화면별 최적화된 응답 생성
- **UI 데이터 구조화**: 컴포넌트 렌더링에 필요한 정확한 데이터 구조 제공

## 아키텍처

### 시스템 구조
```
프론트엔드 (ecommerce-app:3000)
       ↓ UI 최적화된 데이터 요청
BFF 서버 (bff-server:3001) ← 데이터 변환 & 비즈니스 로직 처리
       ↓ 도메인 데이터 요청
┌─────────────────────────────┐
│ 도메인 서비스 (Product Domain)│
│ :4000                       │
└─────────────────────────────┘
```

### 데이터 플로우 예시
```
1. 홈페이지 요청 → BFF가 여러 도메인 데이터 수집
   - 인기 상품 목록
   - 배너 정보
   - 프로모션 데이터
   - 리뷰 통계

2. BFF에서 UI 친화적 형태로 변환
   - 가격 포맷팅 (₩1,000 → "1,000원")
   - 이미지 URL 최적화
   - 태그 색상 매핑
   - 불필요한 필드 제거

3. 프론트엔드로 렌더링 준비된 데이터 전송
```

## 개발 환경

### 로컬 개발
```bash
npm install
npm run dev
```

### Docker 개발
```bash
# docker-compose로 빌드 및 실행
docker-compose up --build bff-server
```

## API 엔드포인트

### 시스템
- `GET /health` - 헬스 체크 엔드포인트
- `GET /docs` - Swagger API 문서

### 비즈니스 API (UI 최적화된 데이터)
- `GET /api/homepage` - 홈페이지 데이터 (배너, 인기상품, 프로모션 통합)
- `GET /api/categories` - 카테고리 목록 (UI 렌더링 최적화)
- `GET /api/products` - 상품 목록 (필터링 & 페이징 지원)
- `POST /api/products` - 상품 등록 (이미지 업로드 & 데이터 검증 포함)

### 데이터 변환 예시
```javascript
// 도메인 응답 → UI 최적화 응답
{
  "price": 15000,
  "discountRate": 0.2
} 
→ 
{
  "displayPrice": "15,000원",
  "originalPrice": "18,750원", 
  "discountText": "20% 할인",
  "finalPrice": 15000
}
```

## BFF의 역할과 가치

### 1. 데이터 변환 레이어
- **도메인 → UI 데이터**: 백엔드 도메인 모델을 프론트엔드가 직접 사용할 수 있는 형태로 변환
- **타입 정규화**: 문자열/숫자 변환, null/undefined 처리, 기본값 설정
- **포맷팅**: 가격, 날짜, 이미지 URL 등 UI 표시용 포맷 적용

### 2. 비즈니스 로직 중앙화  
- **복잡한 계산 로직**: 할인 계산, 포인트 적립률, 배송비 계산
- **상태 판단**: 상품 판매 가능 여부, 재고 상태 표시
- **권한 처리**: 사용자별 노출 데이터 필터링

### 3. 성능 최적화
- **API 호출 최소화**: 여러 도메인 서비스 데이터를 하나의 응답으로 집계
- **불필요한 데이터 제거**: UI에서 사용하지 않는 필드 필터링
- **캐싱**: 자주 요청되는 데이터의 메모리 캐싱

## 환경 변수

사용 가능한 모든 환경 변수는 `.env.example` 파일을 참고하세요.

## 서비스 의존성

- **Product Domain Service**: 상품 관련 도메인 데이터 제공

## 기술 특징

### 성능 최적화
- **고속 처리**: Fastify 기반으로 Express 대비 2-3배 빠른 성능
- **메모리 효율성**: 낮은 메모리 사용량과 효율적인 리소스 관리
- **스마트 캐싱**: 도메인 데이터 캐싱으로 응답 시간 단축

### 개발자 경험
- **타입 안전성**: 완전한 TypeScript 지원으로 런타임 오류 방지
- **자동 검증**: 입력 데이터 자동 검증 및 타입 변환
- **내장 로깅**: Fastify 내장 로깅 시스템으로 디버깅 효율성
- **API 문서**: Swagger 자동 생성으로 API 문서 항상 최신 상태 유지

### 확장성
- **모듈형 구조**: 컨트롤러, 서비스, 클라이언트 레이어 분리
- **플러그인 아키텍처**: Fastify 플러그인 생태계 활용
- **유연한 배포**: Docker 컨테이너 및 로컬 개발 환경 지원
